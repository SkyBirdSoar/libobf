require_relative '../lib/libobf'

#############################
#       EXAMPLE FROM        #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
#                                                         # 
#  http://www.codewars.com/kata/559536379512a64472000053/ #
#                                                         #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

m = [
      [[["1", 1], ["0", 1], ["5", 1]], [["1", 2], ["0", 1]], [["1", 1], ["0", 2]], [["1", 1], ["0", 1], ["1", 1]], [["1", 1], ["2", 1], ["0", 1]]],
      [[["9", 1], ["1", 1]], [["9", 1], ["3", 1]]],
      [[["1", 2], ["0", 1]], [["1", 1], ["0", 1], ["1", 1]], [["1", 2], ["9", 1]]],
      [[["1", 2], ["6", 1]], [["1", 3]], [["9", 1], ["5", 1]], [["1", 1], ["0", 1], ["5", 1]]],
      [[["1", 2], ["6", 1]], [["1", 3]], [["9", 1], ["5", 1]], [["1", 2], ["5", 1]]],
      [[["1", 2], ["7", 1]], [["1", 2], ["2", 1]], [["9", 2]], [["9", 1], ["7", 1]], [["1", 2], ["5", 1]], [["1", 1], ["0", 1], ["1", 1]]],
      [[["1", 1], ["0", 2]], [["1", 3]], [["1", 2], ["9", 1]], [["1", 2], ["0", 1]], [["9", 2]], [["9", 1], ["7", 1]], [["1", 2], ["5", 1]], [["1", 1], ["0", 1], ["1", 1]]]
    ].map &$-o[?:]

a0 = [*?a..?z]
b = ->_{_%26}
c = ->_{$-o[?.][a0,m[0],_]}
@l = ->_,__{$-o[?.][a0,m[1],b[c[_]+__]]}
@l2 = ->_,__{$-o[?.][_,__ % ($-o[?-]+$-o[?-])==$-o[?_]?m[5]:m[6]]}
a1 = $-o[?.][Hash,m[2],->_,__{_[__]=9-$-o[?.][__,m[3]]}]
@d = ->_{$-o[?.][a1,m[1],_]}
def play_pass _, __
  m = [
        [[["1", 1], ["0", 2]], [["1", 3]], [["1", 2], ["9", 1]], [["1", 2], ["0", 1]], [["9", 2]], [["9", 1], ["7", 1]], [["1", 2], ["5", 1]], [["1", 1], ["0", 1], ["1", 1]]],
        [[["9", 2]], [["1", 1], ["0", 1], ["4", 1]], [["9", 1], ["7", 1]], [["1", 2], ["4", 1]], [["1", 2], ["5", 1]]],
        [[["1", 1], ["0", 1], ["9", 1]], [["9", 1], ["7", 1]], [["1", 2], ["2", 1]]],
        [[["1", 2], ["4", 1]], [["1", 1], ["0", 1], ["1", 1]], [["1", 2], ["8", 1]], [["1", 1], ["0", 1], ["1", 1]], [["1", 2], ["4", 1]], [["1", 2], ["5", 1]], [["1", 1], ["0", 1], ["1", 1]]],
        [[["1", 2], ["9", 1]], [["1", 1], ["0", 1], ["5", 1]], [["1", 2], ["6", 1]], [["1", 1], ["0", 1], ["4", 1]], [["9", 1], ["5", 1]], [["1", 1], ["0", 1], ["5", 1]], [["1", 2], ["0", 1]], [["1", 1], ["0", 2]], [["1", 1], ["0", 1], ["1", 1]], [["1", 1], ["2", 1], ["0", 1]]]
      ].map &$-o[?:]
  a = ->_,i{
    case _
    when ?0..?9 then @d[_]
    when ?a..?z then @l2[@l[_,__],i]
    else _
    end
  }
  $-o[?$][$-o[?+][_,m[0],m[1],m[2],[m[4],a],m[3]]]
end